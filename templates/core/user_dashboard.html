{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Dashboard" %} - {% trans "HealthKart 360" %}{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<style>
/* Interactive Dashboard Styles */
.stat-card {
    transition: all 0.3s ease;
    cursor: pointer;
    border-radius: 15px;
    overflow: hidden;
    backdrop-filter: blur(10px);
}

.stat-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    filter: brightness(1.1) saturate(1.2);
}

.interactive-card:hover .card-hover-overlay {
    opacity: 0.9 !important;
}

.card-hover-overlay {
    transition: opacity 0.3s ease;
    border-radius: 15px;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    animation: fadeInUp 0.6s ease-out;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Interactive Welcome Section with Creative Shape */
.welcome-gradient {
    background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
    background-size: 400% 400%;
    animation: gradientShift 8s ease infinite;
    position: relative;
    overflow: hidden;
    border-radius: 25px 75px 25px 75px;
    transform: perspective(1000px) rotateX(0deg);
    transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    cursor: pointer;
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
}

.welcome-gradient:hover {
    transform: perspective(1000px) rotateX(5deg) translateY(-10px) scale(1.02);
    box-shadow: 0 25px 50px rgba(102, 126, 234, 0.4);
    filter: brightness(1.1) saturate(1.2);
}

.welcome-gradient:active {
    transform: perspective(1000px) rotateX(2deg) translateY(-5px) scale(0.98);
    transition: all 0.1s ease;
}

.welcome-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    animation: shimmer 3s ease-in-out infinite alternate;
    border-radius: 25px 75px 25px 75px;
}

.welcome-gradient::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(135deg, #667EEA, #764BA2, #667EEA);
    border-radius: 27px 77px 27px 77px;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.welcome-gradient:hover::after {
    opacity: 0.8;
    animation: borderGlow 2s ease-in-out infinite alternate;
}

@keyframes borderGlow {
    0% { filter: blur(0px) brightness(1); }
    100% { filter: blur(2px) brightness(1.2); }
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes shimmer {
    0% { opacity: 0.3; }
    100% { opacity: 0.7; }
}

/* Improved Quick Actions Hover Effects */
.card:hover .bg-primary {
    background: linear-gradient(135deg, #3B82F6, #1D4ED8) !important;
    transform: scale(1.05);
    transition: all 0.3s ease;
}

.card:hover .bg-success {
    background: linear-gradient(135deg, #10B981, #059669) !important;
    transform: scale(1.05);
    transition: all 0.3s ease;
}

.card:hover .bg-warning {
    background: linear-gradient(135deg, #F59E0B, #D97706) !important;
    transform: scale(1.05);
    transition: all 0.3s ease;
}

.card:hover .bg-danger {
    background: linear-gradient(135deg, #EF4444, #DC2626) !important;
    transform: scale(1.05);
    transition: all 0.3s ease;
}

.card:hover .bg-info {
    background: linear-gradient(135deg, #06B6D4, #0891B2) !important;
    transform: scale(1.05);
    transition: all 0.3s ease;
}

/* Enhanced Pulse animation for emergency button */
@keyframes pulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
    }
    70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
    }
}

.border-danger:hover {
    animation: pulse 2s infinite;
}

/* Order status badges with better styling */
.badge {
    font-size: 0.75rem;
    padding: 0.375rem 0.75rem;
}

/* Consistent Chart containers with same height */
.chart-container {
    position: relative;
    height: 320px;
    width: 100%;
    min-height: 320px;
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Health Tips container with same height as charts */
.health-tips-container {
    height: 320px;
    min-height: 320px;
    display: flex;
    flex-direction: column;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .stat-number {
        font-size: 2rem;
    }

    .container-fluid {
        padding-left: 1rem !important;
        padding-right: 1rem !important;
    }

    .chart-container, .health-tips-container {
        height: 280px;
        min-height: 280px;
    }
}
</style>

<div class="container-fluid py-4 px-5">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card welcome-gradient text-white">
                <div class="card-body py-5">
                    <h2 class="fw-bold mb-2">
                        <i class="fas fa-user-circle me-2"></i>
                        {% trans "Welcome back" %}, {{ user.first_name }}!
                    </h2>
                    <p class="mb-0 opacity-75">{% trans "Manage your health, medicines, and orders from your dashboard." %}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card text-white stat-card" style="background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);" data-bs-toggle="tooltip" data-bs-placement="top" title="Active reminders count">
                <div class="card-body text-center position-relative">
                    <div class="stat-number">{{ active_reminders }}</div>
                    <div class="stat-label">
                        <i class="fas fa-bell me-1"></i>Active Reminders
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card text-white stat-card" style="background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);" data-bs-toggle="tooltip" data-bs-placement="top" title="Pending orders count">
                <div class="card-body text-center position-relative">
                    <div class="stat-number">{{ pending_orders }}</div>
                    <div class="stat-label">
                        <i class="fas fa-clock me-1"></i>Pending Orders
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card text-white stat-card" style="background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);" data-bs-toggle="tooltip" data-bs-placement="top" title="Recent orders count">
                <div class="card-body text-center position-relative">
                    <div class="stat-number">{{ recent_orders|length }}</div>
                    <div class="stat-label">
                        <i class="fas fa-shopping-bag me-1"></i>Recent Orders
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card text-white stat-card" style="background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);" data-bs-toggle="tooltip" data-bs-placement="top" title="Health score based on activity">
                <div class="card-body text-center position-relative">
                    <div class="stat-number">{{ user.first_name|length|add:5 }}</div>
                    <div class="stat-label">
                        <i class="fas fa-heartbeat me-1"></i>Health Score
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="fw-bold text-primary mb-3">
                <i class="fas fa-bolt me-2"></i>Quick Actions
            </h4>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'core:search' %}" class="text-decoration-none">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center py-4">
                        <div class="bg-primary text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                            <i class="fas fa-search fa-lg"></i>
                        </div>
                        <h6 class="card-title fw-bold">üîç Search Medicine</h6>
                        <p class="card-text small text-muted">Find medicines at nearby pharmacies</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'orders:upload_prescription' %}" class="text-decoration-none">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center py-4">
                        <div class="bg-success text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                            <i class="fas fa-camera fa-lg"></i>
                        </div>
                        <h6 class="card-title fw-bold">üßæ Upload Prescription</h6>
                        <p class="card-text small text-muted">Upload and order from prescription</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'reminders:add' %}" class="text-decoration-none">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center py-4">
                        <div class="bg-warning text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                            <i class="fas fa-bell fa-lg"></i>
                        </div>
                        <h6 class="card-title fw-bold">üîî Set Reminder</h6>
                        <p class="card-text small text-muted">Add medicine reminders</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
            <a href="{% url 'core:emergency' %}" class="text-decoration-none">
                <div class="card h-100 border-0 shadow-sm border-danger">
                    <div class="card-body text-center py-4">
                        <div class="bg-danger text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                            <i class="fas fa-exclamation-triangle fa-lg"></i>
                        </div>
                        <h6 class="card-title fw-bold text-danger">üÜò Emergency</h6>
                        <p class="card-text small text-muted">24x7 pharmacy access</p>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Interactive Charts -->
    <div class="row mb-4">
        <div class="col-lg-4 mb-4 d-flex align-items-center">
            <div class="card border-0 shadow-sm w-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Order Status Overview
                    </h5>
                </div>
                <div class="card-body d-flex justify-content-center align-items-center">
                    <div class="chart-container">
                        <canvas id="orderStatusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Health Tips -->
        <div class="col-lg-4 mb-4 d-flex align-items-center">
            <div class="card border-0 shadow-sm w-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>{% trans "Quick Health Tips" %}</h5>
                </div>
                <div class="card-body health-tips-container d-flex flex-column justify-content-center">
                    <div class="row h-100">
                        <div class="col-md-6 d-flex flex-column justify-content-center">
                            <div class="health-tip-item mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="tip-icon-circle bg-primary text-white me-3">
                                        <i class="fas fa-tint"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1 fw-bold">üíß Stay Hydrated</h6>
                                        <p class="mb-0 small text-muted">8 glasses of water daily</p>
                                    </div>
                                </div>
                            </div>
                            <div class="health-tip-item mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="tip-icon-circle bg-success text-white me-3">
                                        <i class="fas fa-apple-alt"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1 fw-bold">ü•ó Balanced Diet</h6>
                                        <p class="mb-0 small text-muted">Fruits & vegetables</p>
                                    </div>
                                </div>
                            </div>
                            <div class="health-tip-item mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="tip-icon-circle bg-warning text-white me-3">
                                        <i class="fas fa-running"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1 fw-bold">üèÉ‚Äç‚ôÇÔ∏è Exercise</h6>
                                        <p class="mb-0 small text-muted">30 minutes daily</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 d-flex flex-column justify-content-center">
                            <div class="health-tip-item mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="tip-icon-circle bg-info text-white me-3">
                                        <i class="fas fa-moon"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1 fw-bold">üò¥ Quality Sleep</h6>
                                        <p class="mb-0 small text-muted">7-8 hours nightly</p>
                                    </div>
                                </div>
                            </div>
                            <div class="health-tip-item mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="tip-icon-circle bg-secondary text-white me-3">
                                        <i class="fas fa-brain"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1 fw-bold">üßò Stress Management</h6>
                                        <p class="mb-0 small text-muted">Meditation & hobbies</p>
                                    </div>
                                </div>
                            </div>
                            <div class="health-tip-item mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="tip-icon-circle bg-danger text-white me-3">
                                        <i class="fas fa-pills"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1 fw-bold">üíä Medication</h6>
                                        <p class="mb-0 small text-muted">As prescribed</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4 d-flex align-items-center">
            <div class="card border-0 shadow-sm w-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>Health Progress Radar
                    </h5>
                </div>
                <div class="card-body d-flex justify-content-center align-items-center">
                    <div class="chart-container">
                        <canvas id="healthProgressChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Orders -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-shopping-bag me-2"></i>Recent Orders
                    </h5>
                </div>
                <div class="card-body">
                    {% if recent_orders %}
                        {% for order in recent_orders %}
                        <div class="d-flex justify-content-between align-items-start mb-3 p-3 border rounded">
                            <div>
                                <h6 class="fw-bold mb-1">Order #{{ order.id }}</h6>
                                <p class="text-muted small mb-1">
                                    <i class="fas fa-store me-1"></i>{{ order.pharmacy.name }}
                                </p>
                                <p class="text-muted small mb-0">
                                    <i class="fas fa-calendar me-1"></i>{{ order.created_at|date:"M d, Y" }}
                                </p>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-{{ order.status|lower }} mb-2">
                                    {{ order.get_status_display }}
                                </span>
                                <div class="fw-bold text-primary">‚Çπ{{ order.total_amount }}</div>
                            </div>
                        </div>
                        {% endfor %}

                        <div class="text-center mt-3">
                            <a href="{% url 'orders:my_orders' %}" class="btn btn-primary">
                                <i class="fas fa-list me-2"></i>View All Orders
                            </a>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
                            <h6 class="text-muted">No orders yet</h6>
                            <p class="text-muted small">Start by searching for medicines or uploading a prescription</p>
                            <a href="{% url 'core:search' %}" class="btn btn-primary">
                                <i class="fas fa-search me-2"></i>Search Medicines
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Active Reminders -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-bell me-2"></i>Medicine Reminders
                    </h5>
                </div>
                <div class="card-body">
                    {% if active_reminders > 0 %}
                        <div class="text-center py-3">
                            <i class="fas fa-bell fa-2x text-warning mb-2"></i>
                            <p class="text-muted">You have {{ active_reminders }} active reminder{{ active_reminders|pluralize }}</p>
                            <a href="{% url 'reminders:list' %}" class="btn btn-warning me-2">
                                <i class="fas fa-cog me-2"></i>Manage Reminders
                            </a>
                            <a href="{% url 'reminders:add' %}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Add New Reminder
                            </a>
                        </div>
                    {% else %}
                        <div class="text-center py-3">
                            <i class="fas fa-bell fa-2x text-warning mb-2"></i>
                            <p class="text-muted">No active reminders. Set up medicine reminders to stay on track!</p>
                            <a href="{% url 'reminders:add' %}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Add Your First Reminder
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Global variables for charts and intervals
let orderStatusChart = null;
let healthProgressChart = null;
let pulseInterval = null;
let chartUpdateInterval = null;

// Initialize dashboard on DOM load
document.addEventListener('DOMContentLoaded', function() {
    initializeTooltips();
    initializeStatCards();
    initializeHoverEffects();
    initializeAnimations();
    initializeCharts();
    initializePulseEffect();
    initializeSmoothScrolling();
    initializeDynamicUpdates();
});

// Initialize Bootstrap tooltips
function initializeTooltips() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
}

// Initialize stat card interactions
function initializeStatCards() {
    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach(card => {
        card.addEventListener('click', function() {
            const tooltip = bootstrap.Tooltip.getInstance(this);
            if (tooltip) {
                tooltip.hide();
            }

            // Add click animation
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
        });
    });
}

// Initialize hover effects for cards
function initializeHoverEffects() {
    const actionCards = document.querySelectorAll('.card');
    actionCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });

        card.addEventListener('mouseleave', function() {
            this.style.transform = '';
        });
    });

    // Interactive hover effects for quick action icons
    const actionIcons = document.querySelectorAll('.card-body .rounded-circle');
    actionIcons.forEach(icon => {
        icon.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1) rotate(5deg)';
            this.style.transition = 'transform 0.3s ease';
        });

        icon.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1) rotate(0deg)';
        });
    });
}

// Initialize animations
function initializeAnimations() {
    // Animate stat numbers on load
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach((number, index) => {
        setTimeout(() => {
            number.style.animation = 'fadeInUp 0.6s ease-out';
        }, index * 100);
    });

    // Enhanced animations with Animate.css classes
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.classList.add('animate__animated', 'animate__fadeInUp');
        card.style.animationDelay = `${index * 0.1}s`;
    });

    // Add loading animation for links
    const links = document.querySelectorAll('a');
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            if (this.href && !this.href.includes('#')) {
                const spinner = document.createElement('i');
                spinner.className = 'fas fa-spinner fa-spin ms-2';
                this.appendChild(spinner);
            }
        });
    });
}

// Initialize Chart.js charts
function initializeCharts() {
    // Order Status Doughnut Chart
    const orderStatusCtx = document.getElementById('orderStatusChart');
    if (orderStatusCtx) {
        orderStatusChart = new Chart(orderStatusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Pending', 'Confirmed', 'Ready', 'Delivered'],
                datasets: [{
                    label: 'Order Status',
                    data: [5, 3, 2, 1], // Placeholder data
                    backgroundColor: [
                        'rgba(255, 206, 86, 0.7)', // Pending - yellow
                        'rgba(54, 162, 235, 0.7)', // Confirmed - blue
                        'rgba(255, 159, 64, 0.7)', // Ready - orange
                        'rgba(75, 192, 192, 0.7)'  // Delivered - green
                    ],
                    borderColor: [
                        'rgba(255, 206, 86, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                animation: {
                    animateRotate: true,
                    animateScale: true
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }

    // Health Progress Radar Chart
    const healthProgressCtx = document.getElementById('healthProgressChart');
    if (healthProgressCtx) {
        healthProgressChart = new Chart(healthProgressCtx, {
            type: 'radar',
            data: {
                labels: ['Medication Adherence', 'Exercise', 'Sleep', 'Diet', 'Stress Management'],
                datasets: [{
                    label: 'Health Progress',
                    data: [80, 70, 60, 90, 75], // Placeholder data
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        top: 20,
                        bottom: 20,
                        left: 20,
                        right: 20
                    }
                },
                scales: {
                    r: {
                        ticks: {
                            beginAtZero: true,
                            max: 100,
                            stepSize: 20
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        },
                        angleLines: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        },
                        pointLabels: {
                            font: {
                                size: 12
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    }
                }
            }
        });
    }
}

// Initialize pulse effect for emergency button
function initializePulseEffect() {
    const emergencyBtn = document.querySelector('.border-danger');
    if (emergencyBtn) {
        pulseInterval = setInterval(() => {
            emergencyBtn.style.boxShadow = '0 0 20px rgba(220, 53, 69, 0.5)';
            setTimeout(() => {
                emergencyBtn.style.boxShadow = '';
            }, 1000);
        }, 3000);
    }
}

// Initialize smooth scrolling
function initializeSmoothScrolling() {
    const internalLinks = document.querySelectorAll('a[href^="#"]');
    internalLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// Initialize dynamic updates
function initializeDynamicUpdates() {
    // Auto-refresh charts every 2 minutes
    chartUpdateInterval = setInterval(() => {
        if (orderStatusChart) {
            // Simulate data update
            const newData = orderStatusChart.data.datasets[0].data.map(() => Math.floor(Math.random() * 10));
            orderStatusChart.data.datasets[0].data = newData;
            orderStatusChart.update();
        }

        if (healthProgressChart) {
            // Simulate data update
            const newData = healthProgressChart.data.datasets[0].data.map(() => Math.floor(Math.random() * 100));
            healthProgressChart.data.datasets[0].data = newData;
            healthProgressChart.update();
        }
    }, 120000); // 2 minutes
}

// Cleanup function for memory management
function cleanup() {
    if (pulseInterval) {
        clearInterval(pulseInterval);
    }
    if (chartUpdateInterval) {
        clearInterval(chartUpdateInterval);
    }
    if (orderStatusChart) {
        orderStatusChart.destroy();
    }
    if (healthProgressChart) {
        healthProgressChart.destroy();
    }
}

// Cleanup on page unload
window.addEventListener('beforeunload', cleanup);
</script>
{% endblock %}
{% endblock %}
